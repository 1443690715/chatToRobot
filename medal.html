<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="css/app.css" />
		<link rel="stylesheet" href="css/medal.css" />
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<span class="mui-pull-left mui-icon mui-icon-arrowleft mui-action-back"></span>
			<h1 class="mui-title">勋章墙</h1>
		</header>
		<div class="mui-content">
			<div class="mine-info">
				<img src="images/T.png" class="mine-head-img" />
				<p class="mine-name">张靖bibibi</p>
				<img class="wall-img" src="images/wall.svg" />
			</div>
			<div class="medal-wall mui-grid-9">
				<div class="medal-wall-cell mui-col-xs-4">
					<canvas id="canvas1" class="canvas unget"></canvas>
				</div>
				<div class="medal-wall-cell mui-col-xs-4">
					<canvas id="canvas1" class="canvas unget"></canvas>
				</div>
				<div class="medal-wall-cell mui-col-xs-4">
					<canvas id="canvas1" class="canvas unget"></canvas>
				</div>
				<div class="medal-wall-cell mui-col-xs-4">
					<canvas id="canvas1" class="canvas unget"></canvas>
				</div>
				<div class="medal-wall-cell mui-col-xs-4">
					<canvas id="canvas1" class="canvas unget"></canvas>
				</div>
				<div class="medal-wall-cell mui-col-xs-4">
					<canvas id="canvas1" class="canvas unget"></canvas>
				</div>
				<div class="medal-wall-cell mui-col-xs-4">
					<canvas id="canvas1" class="canvas unget"></canvas>
				</div>
				<div class="medal-wall-cell mui-col-xs-4">
					<canvas id="canvas1" class="canvas unget"></canvas>
				</div>
				<div class="medal-wall-cell mui-col-xs-4">
					<canvas id="canvas1" class="canvas unget"></canvas>
				</div>
			</div>
		</div>
		<script src="js/mui.min.js"></script>
		<script type="text/javascript">
			mui.init();
			var canvas = document.getElementsByClassName("canvas");
			var canvasA = null;
			for(var i = 0; i < canvas.length; i++) {
				drawImgingrey(canvas[i]);
			}

			function drawImgingrey(canvasA) {
				var contextA = canvasA.getContext("2d");
				var image = new Image();
				image.src = "images/head" + (i + 1) + ".png";
				image.onload = function() {
					contextA.drawImage(image, 0, 0, canvasA.width, canvasA.height);
					if(canvasA.className == "canvas unget") {
						greyEffect(canvasA);
					}
				};
			};

			function greyEffect(canvasA) {
				var contextA = canvasA.getContext("2d");
				var imageData = contextA.getImageData(0, 0, canvasA.width, canvasA.height);
				var pixelData = imageData.data;

				for(var i = 0; i < canvasA.width * canvasA.height; i++) {
					var r = pixelData[i * 4 + 0];
					var g = pixelData[i * 4 + 1];
					var b = pixelData[i * 4 + 2];

					var grey = r * 0.3 + g * 0.59 + b * 0.11;

					pixelData[i * 4 + 0] = grey;
					pixelData[i * 4 + 1] = grey;
					pixelData[i * 4 + 2] = grey;
				}
				contextA.putImageData(imageData, 0, 0, 0, 0, canvasA.width, canvasA.height);
			};
			mui.plusReady(function() {
				var medal_num = plus.storage.getItem("light_medal_num");
				console.log(medal_num);
				for(var j = 0; j < medal_num; j++) {
					drawImg(canvas[j]);
				};

				function drawImg(canvasA) {
					var contextA = canvasA.getContext("2d");
					var image = new Image();
					image.src = "images/head" + (j + 1) + ".png";
					console.log(image.src);
					image.onload = function() {
						contextA.drawImage(image, 0, 0, canvasA.width, canvasA.height);
					};
				};
			});
		</script>
	</body>

</html>